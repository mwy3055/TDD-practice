# Chapter 07. 대역

## 대역?

테스트를 작성하다 보면 외부 객체를 가져다 써야 할 때가 있다. 예를 들어 파일 시스템을 사용하는 경우, 데이터베이스에서 데이터를 가져오는 경우가 있다. 하지만 테스트가 외부 객체에 의존하다 보면 테스트의 작성 및
유지보수가 어려워진다. 외부 객체가 바뀌는 경우 테스트 코드도 바뀌어야 하기 때문이다.

테스트가 외부 객체에 의존하는 경우에는 **테스트 대역**(test double)을 사용하면 좋다. 테스트 대역이란 외부 객체의 동작을 모방하는 객체이다. 외부 객체와의 차이점은 테스트를 작성하는 사람이 온전히
통제할 수 있다는 점이다.

테스트 대역의 핵심은 **외부 객체의 행동을 최대한 간단하게 모방하는 것**이다. 예를 들어 데이터베이스를 모방하는 test double을 만든다면, 실제 DB 대신 `Set`에 저장하도록 구현할 수 있다. 이렇게
하면 외부 DB 대신 메모리에 데이터를 저장하므로 테스트의 속도도 매우 빨라진다.

## 대역의 종류

### Dummy

컴파일 에러 등을 해결하기 위해 구현만 해 둔 객체이다. 실제로 사용하지는 않지만 테스트의 실행을 위해 뼈대만 세워두는 것이다.

### Fake

`Fake`는 외부 객체의 복잡한 동작을 단순하게 구현한다. 위에서 말한 데이터를 `Set`에 저장하는 방식이 해당한다. 의도하는 동작 자체는 제대로 수행하지만 실제 제품에 사용하기는 부적합하다.

### Stub

`Stub`은 에러 없이 동작하는 것처럼 보이지만, 실제로 원하는 방식으로 동작하지는 않는다. 예를 들어 데이터베이스의 행동을 모방하는 `Stub`은 데이터를 찾는 연산에 대해 항상 같은 결과를 반환한다.
이처럼 `Stub`은 테스트를 위해 의도된 결과만을 반환하기도 한다.

### Spy

`Stub`과 유사하지만, 자신이 호출된 내역을 기록한다. 예를 들어 `DatabaseSpy`는 특정 DB 함수가 호출된 횟수를 기록할 수 있다.

### Mock

`Mock`은 어떤 입력에 대해 특정 결과를 반환하도록 설정될 수 있는 객체를 말한다. 예를 들어 `1`이 입력됐을 때 `3`을 반환하도록 설정하고, 실제 입력으로 `1`이 주어졌을 때 `3`을 반환하는지 확인하는
테스트를 작성할 수 있다.
> 솔직히 Mock을 쓸 일이 있을지..?
## 대역을 잘 쓰려면
테스트에서 대역을 잘 쓰려면 **코드를 추상화해야 한다**. 내가 원하는 동작을 `interface`로 정의해 두고, 실제 외부 객체와 대역이 `interface`를 구현하도록 해야 한다.
그래야 일반적이고 깔끔한 테스트 코드를 작성할 수 있다.
## 대역과 개발 속도
TDD는 테스트를 계속 작성해야만 개발을 진행할 수 있다. 그런데 외부 객체 때문에 테스트를 작성하는 시간이 오래 걸린다면 실제 코드를 개발하는 시간 역시 길어질 것이다.

대역을 사용하면 실제 구현이 없어도 다양한 상황을 테스트할 수 있으며, 실행 결과를 빠르게 확인할 수 있다. 
즉 대역은 외부 객체를 실제로 사용하지 않고도 테스트를 완성할 수 있게 해주며, TDD의 개발 속도를 높이는 데 큰 도움이 된다.