# Chapter 06. 테스트 코드의 구성

## 외부 상황과 외부 결과

테스트 코드는 최대한 외부 상황에 영향받지 않게 작성해야 한다. 예를 들어 파일이 없는 상황을 테스트한다고 가정하자. 대충 `fakefile` 파일이 없을 거라고 가정해서 테스트를 작성했는데, 실제로 그 파일이
있다면 올바른 테스트에 실패할 것이다. 이런 경우에는 명시적으로 파일이 없는 상황을 만들어야 한다. 예를 들어 파일을 지웠다가 테스트 후에 복구하던가 해야 한다.

또는 아예 파일을 사용하지 않아도 된다. 파일 탐색 그 자체를 테스트하려는 목적이 아니라면, 테스트 데이터를 파일 대신 테스트 코드에 넣어도 된다.

### 외부 상태에 영향받지 않기

위에서 테스트를 최대한 독립적으로 작성하자고 했다. 독립적이지 않은 테스트는 실행 환경에 따라 결과가 달라질 수 있다. TDD에서 테스트 코드의 검증력이 위협받아서는 안 된다.

예를 들어 데이터베이스에 데이터를 넣는 테스트 코드를 작성한다고 해 보자. 이때 각 테스트가 실행되기 전에 DB의 값을 통제해야 한다. 테스트가 끝날 때마다 DB를 비우는 것이 제일 좋다. 소위 `찌꺼기`를 없애라는
뜻인데, 각 테스트가 `찌꺼기`를 치우지 않으면 실행 순서에 따라 테스트 결과가 달라질 수도 있기 때문이다.

### 외부 상황이 꼭 필요한 경우

외부 API의 응답 JSON을 파싱하는 코드를 작성했다고 가정하자. 테스트의 본 목적은 JSON이 제대로 파싱되는지 확인하는 것이지만, 테스트를 작성하다 보면 점점 테스트가 API에 종속된다. 예를 들어 API
서버가 응답하지 않고 있다면? API의 반환 형식이 달라졌다면?

이처럼 어쩔 수 없이 외부 상황에 영향받는 경우가 있다. 이런 경우에는 적절한 `테스트 대역(test double)`을 사용할 수 있다. 테스트 대역이 무엇인지는 7장에서 살펴보자. 